import React, { useState } from 'react'
import { Link } from 'react-router-dom'
import './Header.css'
import storage from '../../utils/storage.js'
import avatar from '../../assets/avatar.png'

function Header() {
	const [user] = useState(() => storage.getUser())

	const isAuthenticated = Boolean(user)
	const isAdmin =
		user?.role === 'ADMIN' ||
		user?.role === 'ROLE_ADMIN' ||
		(String(user?.role || '')
			.toUpperCase()
			.includes('ADMIN') ??
			false)

	const displayName = user?.username || user?.nickname || 'Профиль'
	const handleLogout = () => {
		storage.clearAuth()
		globalThis.location.href = '/auth'
	}

	return (
		<div>
			<header>
				<Link to='/'>
					<div className='header__logo'>
						<svg
							width='59'
							height='63'
							viewBox='0 0 59 63'
							fill='none'
							xmlns='http://www.w3.org/2000/svg'
						>
							<path
								d='M54.2764 22.3785L54.656 21.4534L54.4736 21.3785H54.2764V22.3785ZM55.2764 31.1823C55.2764 30.63 54.8287 30.1823 54.2764 30.1823C53.7241 30.1823 53.2764 30.63 53.2764 31.1823H54.2764H55.2764ZM54.2764 62V63H55.2764V62H54.2764ZM1 62H0V63H1V62ZM10.3065 27.2243C10.3065 26.672 9.85882 26.2243 9.30653 26.2243C8.75425 26.2243 8.30653 26.672 8.30653 27.2243H9.30653H10.3065ZM1 1V0H0V1H1ZM54.2764 1H55.2764V0H54.2764V1ZM53.2764 22.2865C53.2764 22.8387 53.7241 23.2865 54.2764 23.2865C54.8287 23.2865 55.2764 22.8387 55.2764 22.2865H54.2764H53.2764ZM54.2764 31.215V32.215H54.377L54.4756 32.1949L54.2764 31.215ZM54.2764 22.3785V21.3785H14.892V22.3785V23.3785H54.2764V22.3785ZM54.2764 31.1823H53.2764V62H54.2764H55.2764V31.1823H54.2764ZM54.2764 62V61H1V62V63H54.2764V62ZM5.15327 25.0864H4.15327C4.15327 27.1534 5.50962 28.5696 6.8585 29.1092C7.52093 29.3742 8.31656 29.4819 9.02127 29.2068C9.38873 29.0633 9.72628 28.8148 9.96583 28.4473C10.2036 28.0825 10.3065 27.6596 10.3065 27.2243H9.30653H8.30653C8.30653 27.3449 8.27967 27.3715 8.29032 27.3552C8.30273 27.3362 8.31581 27.3352 8.2939 27.3437C8.21988 27.3726 7.97718 27.4026 7.6013 27.2522C6.87355 26.9611 6.15327 26.1963 6.15327 25.0864H5.15327ZM16.1535 26.4167H17.1535C17.1535 24.2163 16.3671 22.506 15.1192 21.3342C13.8886 20.1787 12.2751 19.6075 10.699 19.5355C9.12731 19.4637 7.51598 19.8846 6.27343 20.8132C5.00621 21.7602 4.15327 23.2187 4.15327 25.0864H5.15327H6.15327C6.15327 23.8899 6.67535 23.0096 7.47067 22.4153C8.29065 21.8025 9.42937 21.4795 10.6077 21.5334C11.7816 21.587 12.9182 22.011 13.7502 22.7922C14.5648 23.5571 15.1535 24.7251 15.1535 26.4167H16.1535ZM1 28.6406L0.106148 29.089C0.906044 30.6837 2.37591 31.9701 4.04977 32.8516C5.73086 33.7368 7.69924 34.2579 9.59801 34.2563C11.4953 34.2547 13.3992 33.7277 14.8396 32.4233C16.2987 31.102 17.1535 29.0998 17.1535 26.4167H16.1535H15.1535C15.1535 28.6581 14.4542 30.0741 13.4971 30.9408C12.5214 31.8244 11.1472 32.255 9.59629 32.2563C8.04682 32.2576 6.39691 31.8272 4.98162 31.0819C3.5591 30.3328 2.45451 29.31 1.89385 28.1923L1 28.6406ZM1 62H2V28.6406H1H0V62H1ZM1 28.6406H2V1H1H0V28.6406H1ZM54.2764 1H53.2764V22.2865H54.2764H55.2764V1H54.2764ZM1 1V2H54.2764V1V0H1V1ZM54.2764 31.215L54.4756 32.1949C55.4813 31.9905 56.4453 31.4105 57.2083 30.6565C57.9752 29.8987 58.5999 28.9056 58.8645 27.7984C59.1334 26.6733 59.0255 25.4372 58.3255 24.2834C57.6343 23.1442 56.4237 22.1788 54.656 21.4534L54.2764 22.3785L53.8967 23.3036C55.3973 23.9195 56.2089 24.6504 56.6156 25.3208C57.0135 25.9767 57.0793 26.6637 56.9193 27.3335C56.7549 28.0212 56.348 28.6949 55.8025 29.2339C55.2532 29.7768 54.6239 30.1239 54.0772 30.235L54.2764 31.215ZM54.2764 31.215V30.215L14.7487 30.215V31.215V32.215L54.2764 32.215V31.215ZM16.298 21.8084H17.298V1H16.298H15.298V21.8084H16.298ZM27.4689 62H28.4689V31.5H27.4689H26.4689V62H27.4689ZM38.9261 22.3785H39.9261V1H38.9261H37.9261V22.3785H38.9261Z'
								fill='#E7B698'
							/>
						</svg>
						<span>
							ОКНО <br /> <em>в Россию</em>
						</span>
					</div>
				</Link>

				<nav>
					<a href='/'>Главная</a>
					<a href='/products'>Товары</a>
					{isAuthenticated && <a href='/orders'>Мои заказы</a>}
					{isAuthenticated && <a href='/cart'>Корзина</a>}
					{isAdmin && <a href='/admin'>Админ-панель</a>}
					{isAuthenticated ? (
						<div className='header__user'>
							<img src={avatar} alt='avatar' className='header__avatar' />
							<span className='header__nickname'>{displayName}</span>
							<div className='header__user-menu'>
								<button type='button' onClick={handleLogout}>
									Выйти
								</button>
							</div>
						</div>
					) : (
						<a href='/auth'>Войти</a>
					)}
				</nav>
			</header>
		</div>
	)
}

export default Header
